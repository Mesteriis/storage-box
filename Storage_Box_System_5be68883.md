# Система ящиков для хранения мелочей

## Обзор компонентов

Модель состоит из 4 основных частей:
1. **Корпус (shell)** — внешний контейнер с направляющими и соединительными элементами
2. **Ящик (drawer)** — выдвижной лоток со стопорами и держателем этикетки
3. **Разделители (dividers)** — съёмные перегородки для отсеков
4. **Система соединения** — автоматически выбирается по размеру

**Премиум-функции**:
- Акустический профиль (silent / soft_click / mech_click)
- Сервисный канал продувки (dusty mode)
- Самонастраивающийся анти-люфт (пружинный ус)
- Shadow gap по периметру фронта
- Направляющие-маяки для точной сборки
- Герметичная версия (O-profile паз)

**Стиль "Беловодье"** — полноценный дизайн-пакет:
- Двухступенчатая "сакральная" фаска
- Рунические паттерны (chevron, knot, wave, grid)
- Палитра из 8 цветов (4 основных + 4 акцента)
- Ручка Hidden Hook / Rune Slot
- Этикетка "рамка-портал" / "скрижаль"

**YAML конфигурация**: сохранение/загрузка параметров + 4 готовых пресета

## Enum-конфигурации

```python
class DesignStyle(Enum):
    # Футуристичные, но сдержанные стили для умного дома
    NORDIC = "nordic"           # Скандинавский минимализм: мягкие углы R=5мм, чистые линии
    TECHNO = "techno"           # Техно: скошенные фаски 45°, тонкие линии-акценты
    BAUHAUS = "bauhaus"         # Баухаус: геометрия + функция, контрастные вставки
    ORGANIC = "organic"         # Органика: плавные S-кривые, природные формы
    PARAMETRIC = "parametric"   # Параметрический: волновой паттерн на боках
    STEALTH = "stealth"         # Стелс: острые грани, невидимые соединения
    BELOVODIE = "belovodie"     # Беловодье: тёплый техно-сакральный минимализм

class ConnectionType(Enum):
    DOVETAIL = "dovetail"       # Ласточкин хвост
    MAGNET = "magnet"           # Под магниты 6×3 мм
    CLIP = "clip"               # Защёлки
    NONE = "none"               # Без соединения

class MaterialType(Enum):
    HYPER_PLA = "hyper_pla"     # Зазор 0.3 мм
    PETG = "petg"               # Зазор 0.4 мм
    ABS = "abs"                 # Зазор 0.35 мм

class DividerLayout(Enum):
    AUTO = "auto"               # Авторасчёт по размерам
    GRID_2X2 = "grid_2x2"
    GRID_2X3 = "grid_2x3"
    GRID_3X3 = "grid_3x3"
    NONE = "none"

class RailProfile(Enum):
    RECTANGULAR = "rectangular" # Простой прямоугольный (базовый)
    V_PROFILE = "v_profile"     # V-образный (самоцентрирование)
    DOVETAIL = "dovetail"       # Ласточкин хвост (антилюфт)
    T_SLOT = "t_slot"           # T-профиль (жёсткий)

class DividerMode(Enum):
    SNAP = "snap"               # Быстросъёмные (пальцами)
    LOCK = "lock"               # С замком (для мастерской)

class PrinterProfile(Enum):
    CREALITY_K1C = "k1c"        # Creality K1C (0.4 сопло, 0.2 слой)
    GENERIC_FDM = "fdm"         # Стандартный FDM
    HIGH_DETAIL = "hd"          # Высокое качество (0.12 слой)

class SoundProfile(Enum):
    SILENT = "silent"           # Мягкое закрытие, TPU демпфер
    SOFT_CLICK = "soft_click"   # Приятный короткий щелчок стопора
    MECH_CLICK = "mech_click"   # Отчётливый "камертон" (резонатор)

class RunePattern(Enum):
    NONE = "none"               # Без паттерна
    CHEVRON_RUNE = "chevron"    # "Ёлочка" — защита
    KNOT_LINE = "knot"          # Прерывистая линия — узел
    WAVE_RUNE = "wave"          # Ломаная волна (не синус!)
    GRID_RUNE = "grid"          # Решётка с точками

class BelovodieColor(Enum):
    # Основные (корпус)
    MIST_WHITE = "mist_white"       # Матовый белый (RAL 9016)
    STONE_SAND = "stone_sand"       # Тёплый песочный (RAL 1015)
    ASH_GREY = "ash_grey"           # Светло-серый (RAL 7035)
    OBSIDIAN = "obsidian"           # Чёрный матовый (RAL 9005)
    
    # Акценты
    EMERALD_DEEP = "emerald_deep"   # Тёмный изумруд
    BRONZE_WARM = "bronze_warm"     # Тёплая бронза
    RUNE_RED = "rune_red"           # Приглушённый красный
    FROST_BLUE = "frost_blue"       # Холодный голубой
```

## Механика направляющих (Rail System)

### V-профиль с самоцентрированием

```
Разрез направляющей:

Корпус:          Ящик:
    ╲    ╱           ╲  ╱
     ╲  ╱             ╲╱
      ╲╱              ││
      ││              ╱╲
                     ╱  ╲
```
- Угол V: 45° (оптимум для PLA/PETG)
- Самоцентрирование при выдвижении
- Компенсация температурного расширения

### Анти-пыль: лабиринт + окна

```
Вид сбоку (направляющая):

Корпус:  ┌─────┐  ┌─────┐  ┌─────┐   ← Окна каждые 35 мм
         │░░░░░│  │░░░░░│  │░░░░░│   ← Рельс
    ┌────┴─────┴──┴─────┴──┴─────┴────┐
    │    Пылевая губа (козырёк 1 мм)  │
    └─────────────────────────────────┘

Ящик:    ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄
         │ Ответная полка (0.8 мм)   │
```
- Козырёк на корпусе: 1 мм вниз
- Полка на ящике: 0.8 мм вверх
- Лабиринт не даёт пыли попасть на рельс
- Окна каждые 35 мм — меньше трения, выход мусора

### Сменные слайд-пэды (анти-скрип)

```
Вид снизу ящика:

┌─────────────────────────────────────┐
│                                     │
│  [PAD]              [PAD]           │  ← Слайд-пэды 8×20×1 мм
│                                     │
│                                     │
│                                     │
│  [PAD]              [PAD]           │
│                                     │
└─────────────────────────────────────┘
```

- 4-6 посадочных мест под сменные "лыжи"
- Крепление: паз с защёлкой
- Варианты материалов:
  - TPU (тихо, печатается, больше трение)
  - PTFE tape (минимум трения, апгрейд)
  - UHMW пластина (долговечно)
- Износился пэд → заменил, не перепечатываешь ящик

### Anti-jam геометрия (lead-in)

```
Вид сверху (вход направляющей):

        Lead-in зона (15 мм)
        ↓
  ╔═════════════════════════════════╗
  ║  ╲                              ║
  ║   ╲  +0.1 мм                    ║  ← Расширение на входе
  ║    ╲________________________    ║
  ║     Основная направляющая       ║
  ╚═════════════════════════════════╝
```

- Заходная фаска: 15° на первых 10-15 мм
- Конусность: +0.05…0.1 мм к зазору на первых 20 мм
- Предотвращает заедание при диагональном выдвижении
- Практически незаметно визуально

### Soft-close демпфер

```
Вид сбоку (закрытие):

                    Демпфер
                       ↓
  ┌─────────────────╔══╗───┐
  │                 ║~~║   │  ← Листовая пружина PETG/TPU
  │    ЯЩИК   →     ║~~║   │    или bumper pocket Ø6-8 мм
  │                 ╚══╝   │
  └─────────────────────────┘
        Последние 10 мм
```

- **Вариант 1**: Листовая пружина PETG/TPU
  - Толщина 0.8 мм, длина 15 мм
  - Ящик "наезжает" на пружину последние 5-10 мм
  
- **Вариант 2**: Bumper pocket
  - Карман под силиконовый бампер Ø6-8 мм
  - Опциональный апгрейд (без бампера — просто карман)

### Анти-люфт клин

```
Вид сверху:

  Корпус
  ┌──────────────────────────────┐
  │    ┌──────────────────┐      │
  │    │                  │◄─────┼── Регулируемый клинышек
  │    │     ЯЩИК         │      │   (под защёлку или винт M3)
  │    │                  │      │
  │    └──────────────────┘      │
  └──────────────────────────────┘
```
- Клин поджимает ящик к противоположной направляющей
- Варианты: защёлка, винт M3, эксцентрик
- Регулировка после печати

### Анти-люфт без клина: пружинный ус (самонастройка)

```
Разрез направляющей:

  Основной V-контакт          Пружинный ус
        ↓                         ↓
  ╔═════╗                   ╔═════╗
  ║  ╲  ║                   ║  ╲  ║~~~┐
  ║   ╲ ║                   ║   ╲ ║   │ ← Ус 0.9-1.1 мм PETG
  ║    ╲║                   ║    ╲║~~~┘   всегда поджимает
  ╚═════╝                   ╚═════╝
  
  Левая сторона              Правая сторона
```

- Одна сторона — основной V-контакт
- Вторая — V + тонкий пружинный ус (PETG 0.9–1.1 мм)
- Ус всегда поджимает ящик к противоположной направляющей
- **Плюсы**: без винтов/регулировок, самонастройка
- Геометрия уса подбирается через test kit

### Направляющие-маяки (auto-align)

```
Вид сверху (вход):

  ┌────────────────────────────────────┐
  │                                    │
  │   ●                          ●     │  ← Микро-конусы входа
  │    ╲                        ╱      │    (ящик сам "находит" рельс)
  │     ╲══════════════════════╱       │
  │      ║  НАПРАВЛЯЮЩАЯ      ║        │
  │     ╱══════════════════════╲       │
  │    ╱                        ╲      │
  │   ●                          ●     │
  │                                    │
  └────────────────────────────────────┘
```

- 2 микро-конуса на входе (высота 1.5 мм, угол 30°)
- Ящик автоматически центрируется при вставке
- Ощущение "премиум сборки"

### Сервисный канал продувки (Dusty Mode)

```
Вид сбоку (корпус):

  ┌───────────────────────────────────────┐
  │    Направляющая                       │
  │    ═══════════════════════════════    │
  │    ┌─────────────────────────────┐    │
  │    │  Канал продувки 2×4 мм      │    │  ← Тоннель вдоль рельса
  │    └─────────────────────────────┘    │
  │                                  ↓    │
  │                             Сервисный │
  │                             порт      │
  └──────────────────────────────────○────┘
                                     ↑
                          Вставил компрессор → продул
```

- Тонкий канал 2×4 мм вдоль рельса
- Выход: сервисный порт снизу корпуса
- Вставил носик компрессора/баллончика → продул направляющую
- Ощущается как "инженерный продукт"

## Акустический профиль (Sound Design)

```python
class SoundProfile(Enum):
    SILENT = "silent"         # Мягкое закрытие, TPU демпфер
    SOFT_CLICK = "soft_click" # Приятный короткий щелчок
    MECH_CLICK = "mech_click" # Отчётливый "камертон"
```

### Акустический язычок (для MECH_CLICK)

```
Вид сбоку (зона стопора):

    ┌────────────────────┬──┐
    │                    │▓▓│
    │    ЯЩИК            │  │
    │               ╱────│  │
    └──────────────╱─────┼──┘
                         │
                    ┌────┴────┐
                    │ ЯЗЫЧОК  │  ← 0.8×6×18 мм
                    │ ~~~~~~~~│    резонирует при касании
                    └─────────┘
```

- Акустическая перемычка 0.8×6×18 мм
- Резонирует при контакте со стопором
- Приятный "щёлк" как у качественных замков

## Двухступенчатые стопоры

```
Вид сбоку (разрез):

         Выдвижение →
    
    ┌────────────────────┬──┐
    │                    │▓▓│ ← Стопор 2: жёсткий упор (не вылетит)
    │    ЯЩИК            │  │
    │               ╱────│  │ ← Стопор 1: пружинная лапка PETG
    └──────────────╱─────┴──┘
                   │
              Release slot (снизу)
              для отвёртки/ногтя
```

- **Стопор 1**: Пружинная лапка из PETG (1.2 мм толщина, 8 мм длина)
  - Мягкий упор, ощущается тактильно
  - Угол 15° для плавного входа
  
- **Стопор 2**: Жёсткий выступ 3 мм
  - Физический ограничитель
  - Не даст ящику вылететь при рывке

- **Release slot**: Окно 15×5 мм снизу корпуса
  - Отжать лапку отвёрткой/ногтем
  - Вынуть ящик без усилия

## Усиление передней панели

```
Вид сзади (передняя панель изнутри):

┌─────────────────────────────────┐
│  ┌───────────────────────────┐  │
│  │                           │  │
│  │    ╔═══════════════╗      │  │ ← Рёбра жёсткости
│  │    ║   (ручка)     ║      │  │   (крест или рамка)
│  │    ╚═══════════════╝      │  │
│  │           │               │  │
│  └───────────┼───────────────┘  │
│              │                  │
│    ══════════╪══════════════    │ ← Горизонтальное ребро
│              │                  │
└──────────────┴──────────────────┘
```

- Рёбра: высота 3 мм, толщина 1.2 мм
- Крестообразная или рамочная схема
- **Обязательно**: внутренние радиусы на ручке R=2 мм (даже в TECHNO)
- Филе параметризовано от толщины стенки: `fillet = wall * 0.8`

## Эргономика ящика

### Режимы ручки (HandleMode)

```python
class HandleMode(Enum):
    PINCH = "pinch"     # Щипковый хват — узкая щель 12×60 мм
    HOOK = "hook"       # Зацеп снизу — палец поддевает снизу
    GLOVE = "glove"     # Увеличенный — для перчаток/мастерской
    INVISIBLE = "invisible"  # Скрытый (push-latch или снизу панели)
```

```
PINCH:          HOOK:           GLOVE:
┌─────────┐    ┌─────────┐    ┌─────────┐
│ ═══════ │    │         │    │ ╔═════╗ │
│         │    │  ╲___╱  │    │ ║     ║ │
└─────────┘    └─────────┘    │ ╚═════╝ │
                              └─────────┘
```

- **PINCH**: узкая прорезь, быстрый хват двумя пальцами
- **HOOK**: выемка снизу, зацеп одним пальцем (удобно при частом открытии)
- **GLOVE**: увеличенный проём 25×80 мм (мастерская, в перчатках)

### Защита от выпадения мелочи

```
Разрез передней кромки:

          Микро-бортик 1.5-2 мм
                 ↓
    ┌────────────┬──┐
    │            │▓▓│  ← Ловит содержимое при резком открытии
    │  ДНО       │  │
    └────────────┴──┘
```

- Микро-бортик внутри передней кромки: 1.5–2.0 мм
- Альтернатива: наклон дна 0.5–1° к задней стенке
- Мелочь не прыгает при резком выдвижении

### Дренажные отверстия (Weep Holes)

```
Вид сверху (дно ящика):

┌─────────────────────────────────┐
│ ◦                           ◦   │  ← Weep holes Ø2-3 мм
│                                 │    в углах
│                                 │
│ ◦                           ◦   │
└─────────────────────────────────┘
```

- 4 отверстия Ø2-3 мм в углах дна
- Выдуть пыль/крошки сжатым воздухом
- Вода не застаивается (если помыть)
- Эстетичный вид (можно скруглить)

## Премиальные детали

### Shadow Gap (премиум-стык без щелей)

```
Разрез фронтальной панели:

        Shadow gap 0.3-0.5 мм
               ↓
  ┌────────────┬─┬────────────┐
  │            │ │            │
  │   КОРПУС   │░│  ФРОНТ     │
  │            │ │            │
  └────────────┴─┴────────────┘
```

- Микрошов по периметру фронта: 0.3–0.5 мм
- Визуально панель выглядит "парящей"
- Скрывает неточности стыка
- Shadow gap вокруг label frame: 0.2–0.3 мм
- **Очень "умный дом"!**

### One-Hand Operation (система одной руки)

```
Вид спереди:

┌─────────────────────────────────┐
│                                 │
│   ┌─────────────────────────┐   │
│   │  Микро-тактильная зона  │   │  ← Рельеф 0.2-0.3 мм
│   │  ░░░░░░░░░░░░░░░░░░░░░  │   │    (палец знает где толкать)
│   │        (ручка)          │   │
│   └─────────────────────────┘   │
│                                 │
└─────────────────────────────────┘
```

- Тактильная зона на фронте (рельеф 0.2–0.3 мм)
- Палец сразу "находит" нужное место
- Ограничитель рывка внутри (не вылетает резко)
- Открыть и закрыть одним пальцем

### Страховочный крючок (для магнитного настенного монтажа)

```
Вид сбоку (настенный):

    Стена
      │
      │  ┌──────┐ ← Страховочный крючок (1-2 мм)
      │  │ ╔════╧══╗     держит сдвиг вниз
      │  │ ║      ║
      │══╧═╝      ╚═══│ ← Магниты отвечают за прижим
      │               │
      │   КОРПУС      │
      │               │
      └───────────────┘
```

- Крючок сверху: 1–2 мм
- Магниты → прижим к стене
- Крючок → удерживает вес
- Даже если магнит слабее/пыль → ящик не "поедет"

### Герметичная версия (MED/OPTIC Preset)

```
Разрез фронта (герметичная версия):

  ┌─────────────────────────────┐
  │                             │
  │   ╔═════════════════════╗   │
  │   ║  O-profile паз      ║   │  ← Силиконовый шнур
  │   ╠═════════════════════╣   │
  │   ║      ФРОНТ          ║   │
  │   ╚═══════╤═══╤═════════╝   │
  │           │ ◆ │             │  ← Боковые клипсы-замки
  └───────────┴───┴─────────────┘
```

- Паз под тонкий силиконовый шнур (O-profile ∅2-3 мм)
- 2 защёлкивающихся замка по бокам фронта
- **Антипыль/антивлага** версия
- Для аптечки, оптики, электроники

## Стабильность: микро-ножки

```
Вид снизу корпуса:

┌─────────────────────────────────┐
│ ●                           ●   │ ← Микро-ножки 0.6 мм
│                                 │   (или фаска по периметру)
│                                 │
│                                 │
│ ●                           ●   │
└─────────────────────────────────┘
```

- 4 ножки по углам: 0.6–0.8 мм высота
- Альтернатива: фаска 0.5×45° по периметру дна (анти elephant foot)
- Компенсация неплоскости стола

## Система стыковки (Stack System)

### Ключевое позиционирование (анти-переворот)

```
Вид сверху (верх корпуса):

┌─────────────────────────────────┐
│  ▲                              │  ← Ключ 1 (асимметричный)
│                                 │
│                            ◆    │  ← Ключ 2 (диагональ)
│                                 │
└─────────────────────────────────┘

Ответные пазы снизу:
┌─────────────────────────────────┐
│  ▽                              │
│                            ◇    │
└─────────────────────────────────┘
```

- 2 ключа по диагонали (не симметрично!)
- Нельзя поставить "не той стороной"
- Форма ключей разная (треугольник + ромб)

### Анти-сдвиговые микро-зубцы

```
Разрез контактной площадки:

       0.3-0.4 мм
         ↓↓↓
    ╱╲╱╲╱╲╱╲╱╲╱╲    ← Микро-гребёнка
    ────────────    ← Ответная поверхность
```

- Высота зубцов: 0.3–0.4 мм
- Шаг: 1 мм
- Не видно снаружи, но держит от сдвига
- Печатается без поддержек (45° склоны)

### Плавающие ножки (компенсация "бананности")

```
Разрез ножки:

  ┌─────────────────┐
  │   ┌───────┐     │
  │   │ ПЯТАК │     │  ← Вставная ножка-пятак
  │   │  ↕    │     │    с ходом 0.5 мм
  │   └───┬───┘     │
  └───────┴─────────┘
      Посадочное место
```

- 4 сменных пятака по углам
- Вертикальный ход: 0.5 мм
- Компенсирует усадку/коробление больших корпусов
- Для настенной версии: пятаки к стене

## Параметрические размеры

Пользователь задаёт **только внешние размеры**, остальное рассчитывается автоматически:

```python
@dataclass
class BoxConfig:
    # Входные параметры (задаёт пользователь)
    width: float = 200.0        # Ширина, мм
    depth: float = 220.0        # Глубина, мм
    height: float = 80.0        # Высота, мм
    
    design: DesignStyle = DesignStyle.NORDIC
    material: MaterialType = MaterialType.HYPER_PLA
    dividers: DividerLayout = DividerLayout.AUTO
    divider_mode: DividerMode = DividerMode.SNAP
    connection: ConnectionType = ConnectionType.DOVETAIL
    rail_profile: RailProfile = RailProfile.V_PROFILE
    printer: PrinterProfile = PrinterProfile.CREALITY_K1C
    
    # Контекст использования
    stack_levels: int = 1           # Сколько ящиков в стопке
    mount: str = "table"            # table / wall
    expected_weight: float = 500.0  # Ожидаемый вес содержимого, г
    target_cell_size: tuple = (50, 50)  # Идеальный размер ячейки, мм

@dataclass  
class DerivedConfig:
    """Вычисленные параметры — готовы к геометрии"""
    config: BoxConfig
    
    # Границы разумного (валидация)
    MIN_WALL = 1.6
    MAX_WALL = 4.8
    MIN_CLEARANCE = 0.15
    MIN_INNER_WIDTH = 40  # Минимум для ящика
    
    @property
    def wall_thickness(self) -> float:
        """Адаптивная толщина стенки"""
        base = 2.0
        # Усиление по площади боковой стенки
        area = self.config.width * self.config.height / 1000  # см²
        if area > 160:      # > 200×80
            base = 3.2
        elif area > 100:    # > 200×50
            base = 2.4
        # Усиление для стопки
        if self.config.stack_levels > 2:
            base += 0.4
        # Округление до кратного 0.4 (сопло)
        return round(base / 0.4) * 0.4
    
    @property
    def tolerances(self) -> dict:
        """Раздельные зазоры по типу соединения"""
        base = {
            MaterialType.HYPER_PLA: 0.30,
            MaterialType.PETG: 0.40,
            MaterialType.ABS: 0.35
        }[self.config.material]
        
        return {
            "slide": base,              # Ящик/направляющие
            "snap": base * 0.7,         # Защёлки (плотнее)
            "pressfit": base * 0.5,     # Магниты/NFC (очень плотно)
            "loose": base * 1.3         # Свободная посадка
        }
    
    @property
    def effective_inner_width(self) -> float:
        """Реальное внутреннее пространство"""
        rail_width = 5.0  # Ширина направляющей
        return (self.config.width 
                - 2 * self.wall_thickness 
                - 2 * rail_width 
                - 2 * self.tolerances["slide"])
    
    @property
    def divider_count(self) -> tuple[int, int]:
        """Авторасчёт по целевому размеру ячейки"""
        if self.config.dividers == DividerLayout.NONE:
            return (0, 0)
        if self.config.dividers != DividerLayout.AUTO:
            # Маппинг фиксированных вариантов
            return {"grid_2x2": (1,1), "grid_2x3": (1,2), "grid_3x3": (2,2)}[self.config.dividers.value]
        
        # Автоподбор по целевому размеру ячейки
        target_w, target_d = self.config.target_cell_size
        inner_w = self.effective_inner_width
        inner_d = self.config.depth - 2 * self.wall_thickness
        
        cols = max(0, round(inner_w / target_w) - 1)
        rows = max(0, round(inner_d / target_d) - 1)
        
        # Валидация: не помещается — уменьшаем
        while cols > 0 and inner_w / (cols + 1) < 25:
            cols -= 1
        while rows > 0 and inner_d / (rows + 1) < 30:
            rows -= 1
            
        return (cols, rows)
    
    @property
    def features_enabled(self) -> dict:
        """Автоотключение фич при маленьких размерах"""
        inner_w = self.effective_inner_width
        return {
            "label": inner_w >= 60,         # Этикетка
            "led_slot": inner_w >= 100,     # LED
            "dividers": inner_w >= 50,      # Разделители
            "smart_cartridge": inner_w >= 80,  # Smart-отсек
            "handle_large": inner_w >= 80,  # Большая ручка
        }
    
    @property
    def connection_auto(self) -> ConnectionType:
        """Умный выбор соединения"""
        cfg = self.config
        
        # Настенный монтаж — магниты или защёлки
        if cfg.mount == "wall":
            return ConnectionType.MAGNET if cfg.width > 150 else ConnectionType.CLIP
        
        # Тяжёлое содержимое — dovetail
        if cfg.expected_weight > 1000:
            return ConnectionType.DOVETAIL
        
        # Высокая стопка — dovetail
        if cfg.stack_levels > 3:
            return ConnectionType.DOVETAIL
        
        # Маленькие — защёлки
        if cfg.height < 50:
            return ConnectionType.CLIP
        
        # По умолчанию
        return cfg.connection
```

## Органический дизайн

При `DesignStyle.ORGANIC`:
- Все внешние углы скруглены (R = 10% от минимального размера)
- Филе на внутренних рёбрах: `fillet = wall_thickness * 0.8` (не фикс 3 мм!)
- Волнистый профиль ручки вместо прямоугольного выреза
- Плавные переходы на соединительных элементах

## Design Tokens (единый язык дизайна)

```python
@dataclass
class DesignTokens:
    """Параметры визуального стиля"""
    # Геометрия
    radius_outer: float         # Внешние углы
    radius_inner: float         # Внутренние углы (филе)
    chamfer: float              # Фаска (для TECHNO)
    
    # Декор
    groove_width: float         # Ширина декоративной канавки
    groove_depth: float         # Глубина канавки
    pattern_type: str           # "none", "lines", "wave", "honeycomb"
    pattern_params: dict        # Параметры паттерна
    
    # Ручка
    handle_profile: str         # Профиль ручки
    handle_inner_radius: float  # Внутренний радиус (обязателен >= 2 мм!)
    
    # Этикетка
    label_frame_style: str      # "flush", "raised", "recessed"
    label_frame_width: float
    
    @classmethod
    def from_style(cls, style: DesignStyle, wall: float) -> "DesignTokens":
        """Фабрика токенов по стилю"""
        presets = {
            DesignStyle.NORDIC: cls(
                radius_outer=5.0, radius_inner=wall*0.6, chamfer=0,
                groove_width=0, groove_depth=0, pattern_type="none", pattern_params={},
                handle_profile="hidden_bottom", handle_inner_radius=3.0,
                label_frame_style="flush", label_frame_width=2.0
            ),
            DesignStyle.TECHNO: cls(
                radius_outer=0, radius_inner=2.0, chamfer=2.0,
                groove_width=0.8, groove_depth=0.5, pattern_type="lines", 
                pattern_params={"spacing": 10, "angle": 0},
                handle_profile="horizontal_slot", handle_inner_radius=2.0,
                label_frame_style="recessed", label_frame_width=1.5
            ),
            # ... другие стили
        }
        return presets.get(style)
```

## Концепция Smart Home

Дизайн-принципы для интеграции в умный дом:

### Визуальная философия
- **Монохромность**: один цвет, разные оттенки через текстуру/тени
- **Скрытая функциональность**: механизмы не видны снаружи
- **Пропорции золотого сечения**: соотношение элементов 1:1.618
- **Negative space**: 40% передней панели — пустота для «воздуха»

### Дополнительные стили

**NORDIC** — Скандинавский минимализм:
- Радиус углов: 5 мм (мягкий, но не детский)
- Ручка: невидимая выемка снизу передней панели
- Этикетка: утоплена заподлицо с поверхностью
- Поверхность: лёгкая матовая текстура (0.1 мм)

**TECHNO** — Техно-футуризм:
- Фаски 45° на всех внешних рёбрах (ширина 2 мм)
- Тонкая линия-канавка по периметру (0.8 мм, глубина 0.5 мм)
- Ручка: горизонтальная прорезь с подсветкой (опция под LED)
- Соединения: скрытые магниты

**BAUHAUS** — Функциональный модернизм:
- Контрастная вставка-рамка вокруг этикетки (печать в 2 цвета)
- Чёткое разделение зон: ручка | этикетка | декор
- Геометрический паттерн на боковинах (линии 1 мм, шаг 10 мм)

**PARAMETRIC** — Параметрический дизайн:
- Боковые стенки: синусоидальный рельеф (амплитуда 1.5 мм, период 20 мм)
- Плавные переходы толщины стенок
- Этикетка в органической форме (эллипс)

**STEALTH** — Невидимый стиль:
- Острые грани, углы без скруглений
- Соединения полностью скрыты (внутренние защёлки)
- Ручка: touch-latch механизм (нажал — выехал)
- Матовая поверхность, поглощающая свет

## Стиль "Беловодье" (BELOVODIE)

**Философия**: "Тёплый техно-сакральный минимализм" — чистые формы + скрытая инженерия + славянская орнаментальность (дозированно, как у премиум устройств).

### Принципы стиля

1. **Скрытая механика**: снаружи ничего не выдаёт "3D-модель"
2. **Руническая геометрия**: не флора-узоры, а строгие линии/знаки
3. **Материал-честность**: монолитные объёмы, аккуратные швы, shadow gap
4. **Тактильные акценты**: пальцу понятно, глазу спокойно
5. **Ночь/день**: днём — матовый монохром, ночью — точечные подсказки

### Палитра Беловодья

**Основные (корпус)**:
- `MIST_WHITE` — матовый белый (RAL 9016)
- `STONE_SAND` — тёплый песочный (RAL 1015)
- `ASH_GREY` — светло-серый (RAL 7035)
- `OBSIDIAN` — чёрный матовый (RAL 9005)

**Акценты (вставки/рамки/метки)**:
- `EMERALD_DEEP` — тёмный изумруд (фирменная "жила")
- `BRONZE_WARM` — тёплая бронза (не жёлтое золото!)
- `RUNE_RED` — приглушённый красный (только для tools/urgent)
- `FROST_BLUE` — холодный голубой (электроника)

### Геометрия Беловодья

**Двухступенчатая "сакральная" фаска**:
```
Разрез угла:

  │
  │  ╲ 0.8 мм @ 45°  ← Первая ступень
  │   ╲
  │    ╲ 0.4 мм @ 20-25°  ← Вторая ступень
  │     ──────────────────
```
- Даёт ощущение "обработанного камня/металла"
- Вместо обычной фаски TECHNO

**Shadow gap (фирменный)**:
- По периметру фронта: 0.3–0.5 мм углубление
- Вокруг label frame: 0.2–0.3 мм
- "Парящая" панель

### Паттерны Беловодья (Rune Patterns)

```python
class RunePattern(Enum):
    CHEVRON_RUNE = "chevron"    # "Ёлочка" — защита
    KNOT_LINE = "knot"          # Прерывистая линия — узел
    WAVE_RUNE = "wave"          # Ломаная волна (не синус!)
    GRID_RUNE = "grid"          # Решётка с точками
```

**Где применять**:
- На боковинах ближе к заднему ребру (не видно спереди)
- Или тонким поясом под фронтом

**Параметры**:
- Глубина: 0.25–0.35 мм (под слой 0.2 на K1C)
- Ширина линий: 0.6–0.8 мм
- Шаг: 6–10 мм

```
CHEVRON_RUNE:           WAVE_RUNE:           KNOT_LINE:
                        
  ╱╲╱╲╱╲╱╲              ╱╲_╱╲_╱╲             ───  ───  ───
  ╲╱╲╱╲╱╲╱              ╲╱ ╲╱ ╲╱             ─────────────
```

### Ручка Беловодья

**Hidden Hook (тихий премиум)**:
```
┌─────────────────────────────┐
│                             │
│          ●                  │  ← Центральный знак-метка (0.25 мм)
│      ╲_______╱              │    палец находит точку
│                             │
└─────────────────────────────┘
```

**Rune Slot (с акцентом)**:
```
┌─────────────────────────────┐
│                             │
│      ╔═══════════════╗      │  ← Шестигранная "руна"
│      ║               ║      │    внутренние радиусы ≥ 2 мм
│      ╚═══════════════╝      │
│                             │
└─────────────────────────────┘
```

### Этикетка Беловодья

**Рамка-портал**:
```
    ┌──────┬─────────────┬──────┐
    │      │             │      │  ← Перемычки сверху/снизу
    │      └─────────────┘      │    (как знак)
    │       ТЕКСТ ЭТИКЕТКИ      │
    │      ┌─────────────┐      │
    │      │             │      │
    └──────┴─────────────┴──────┘
```

**Скрижаль (recessed)**:
- Слегка утоплена в панель
- Shadow gap вокруг
- Метка версии в углу: `BV-1.3`

### DesignTokens для Belovodie

```python
BELOVODIE_TOKENS = DesignTokens(
    radius_outer=5.0,
    radius_inner=wall * 0.7,
    chamfer=1.2,  # Но двухступенчатый!
    chamfer_secondary=0.4,
    chamfer_secondary_angle=22,
    
    groove_width=0.8,
    groove_depth=0.35,
    
    pattern_type="runes",
    pattern_params={
        "motif": "chevron_rune",
        "spacing": 8,
        "band_height": 14,
        "band_position": "back_edge"
    },
    
    handle_profile="hidden_hook_rune",
    handle_inner_radius=2.5,
    handle_tactile_mark=True,
    
    label_frame_style="recessed_portal",
    label_frame_width=2.0,
    shadow_gap=0.4,
    
    # Микро-детали
    version_mark=True,           # Метка BV-x.x на дне
    rune_key=True,               # Ключ стыковки в форме руны
    rivet_dots=True              # Имитация заклёпок на углах фронта
)
```

### Пресеты Беловодья

```python
class BelovodiePreset(Enum):
    DESK = "desk"           # Белый/серый + изумрудная рамка
    WORKSHOP = "workshop"   # Антрацит + бронза на ручке
    MED = "med"             # Песочный + белая скрижаль + уплотнитель
    SACRED = "sacred"       # Полный набор рун + бронза (выставочный)
```

### Опциональные smart-функции

**Smart Cartridge System** — унифицированный отсек вместо дырок везде:

```
Вид сзади корпуса:

┌─────────────────────────────────────┐
│                                     │
│    ┌─────────────────────────┐      │
│    │   SMART CARTRIDGE       │      │  ← Стандартная ниша 30×25×12 мм
│    │   (сменные крышки)      │      │
│    └─────────────────────────┘      │
│                                     │
└─────────────────────────────────────┘

Варианты крышек:
┌─────┐  ┌─────┐  ┌─────┐  ┌─────┐  ┌─────┐
│PLAIN│  │ NFC │  │HALL │  │ESP32│  │CABLE│
│     │  │ ◯   │  │ ═══ │  │ □□□ │  │ ⊙   │
└─────┘  └─────┘  └─────┘  └─────┘  └─────┘
```

```python
class SmartCartridge(Enum):
    PLAIN = "plain"             # Заглушка (базовая версия)
    NFC_13MM = "nfc"            # Под NFC-метку ∅13 мм
    HALL_SENSOR = "hall"        # Датчик холла (геркон)
    ESP_MODULE = "esp"          # ESP32/ESP8266 + micro-USB
    CABLE_PASS = "cable"        # Проход для кабеля ∅5 мм
    TEMP_HUMID = "dht"          # DHT22 (температура/влажность)
```

### Стандартизация магнитов

```
Магнитная вставка (upgradeable):

    ┌───────────────┐
    │   ┌───────┐   │  ← Основной корпус (печатается без магнита)
    │   │ ◯ 6×3 │   │  ← Посадочное место 6.1×3.1 мм
    │   └───────┘   │
    │   [КРЫШКА]    │  ← Заглушка на защёлке
    └───────────────┘
```
- Отверстие: 6.1 мм (pressfit tolerance)
- Глубина: 3.1 мм
- Заглушка печатается отдельно
- Можно печатать без магнитов, апгрейдить потом

### Рекомендуемые цвета для умного дома
- Белый матовый (RAL 9016)
- Светло-серый (RAL 7035)
- Антрацит (RAL 7016)
- Бежевый/песочный (RAL 1015)
- Чёрный матовый (RAL 9005)

## Дополнительные идеи

### Модульные аксессуары

```python
class Accessory(Enum):
    PHONE_DOCK = "phone_dock"         # Док-станция под телефон на крышке
    WIRELESS_CHARGER = "wireless"     # Паз под Qi-зарядку (∅50 мм)
    PENCIL_HOLDER = "pencil"          # Вставка-органайзер для ручек
    WATCH_STAND = "watch"             # Подставка под часы/браслет
    COIN_TRAY = "coin"                # Лоток для мелочи с мягким дном
    KEY_HOOKS = "keys"                # Крючки для ключей (внутри ящика)
    SD_CARD_RACK = "sd_cards"         # Слоты под SD/microSD карты
    USB_ORGANIZER = "usb"             # Держатель USB-накопителей
```

### Инновационные механизмы

**Soft-close (доводчик)**:
- Пружинный механизм из PETG в конце направляющих
- Замедление последних 15 мм хода
- Печатается отдельно, вставляется в корпус

**Quick-release (быстросъём)**:
- Поворотные фиксаторы на 90° вместо стопоров
- Один поворот — ящик вынимается полностью
- Индикатор положения на передней панели

**Тандем-ящик**:
- Два ящика в одном корпусе (верхний мелкий, нижний глубокий)
- Общая передняя панель
- Независимое выдвижение

**Вращающаяся платформа**:
- Крышка-поддон с lazy susan механизмом
- Для стопки ящиков — доступ со всех сторон

### Система маркировки

```python
class LabelSystem(Enum):
    PAPER_SLOT = "paper"          # Классический — бумажка под прозрачной крышкой
    E_INK_MOUNT = "e_ink"         # Крепление под e-ink дисплей (2.9")
    DRY_ERASE = "dry_erase"       # Белая поверхность под маркер
    EMBOSSED = "embossed"         # Тиснёный текст (генерируется при моделировании)
    BRAILLE = "braille"           # Шрифт Брайля (accessibility)
    QR_CODE = "qr"                # Рельефный QR-код (сканируется телефоном)
    ICON_GRID = "icons"           # Сетка иконок (выбор из библиотеки)
```

### Accessibility (доступность)

- **Тактильные метки**: рельефные символы на передней панели
- **Контрастные вставки**: двухцветная печать для слабовидящих
- **Увеличенная ручка**: опция XL для людей с ограниченной моторикой
- **Звуковой индикатор**: отверстие под пьезо-пищалку (при открытии)
- **Магнитные направляющие**: для людей с тремором (ящик сам центрируется)

### Система настенного монтажа

```python
class MountType(Enum):
    FRENCH_CLEAT = "french_cleat"   # Французский подвес (45°)
    KEYHOLE = "keyhole"             # Замочная скважина под шуруп
    RAIL_SYSTEM = "rail"            # Совместимость с IKEA SKÅDIS
    MAGNETIC = "magnetic"           # Металлическая пластина + магниты
    ADHESIVE = "adhesive"           # Площадка под 3M Command
```

### Умные интеграции

**Архитектура "Hub + Passive"** (без проводов в каждом ящике):

```
┌─────────────────────────────────────────┐
│           СТОЙКА / ПОЛКА                │
│  ┌───────────────────────────────────┐  │
│  │  HUB: ESP32 + Hall sensors        │  │  ← Один хаб на всю стойку
│  │       + питание                   │  │
│  └───────────────────────────────────┘  │
│                                         │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐       │
│  │ ◯◯  │ │ ◯   │ │ ◯◯◯ │ │ ◯   │       │  ← Ящики с пассивными метками
│  │ M:01│ │ M:02│ │ M:03│ │ M:04│       │    (магнитный код / NFC / QR)
│  └─────┘ └─────┘ └─────┘ └─────┘       │
└─────────────────────────────────────────┘
```

**Пассивные метки (без электроники в ящике)**:

```python
class PassiveTag(Enum):
    NFC = "nfc"                 # NFC-метка ∅13 мм (сканер/телефон)
    MAGNET_CODE = "magnet"      # 1-3 магнита = код (Hall в хабе)
    QR_EMBOSSED = "qr"          # Рельефный QR (можно покрасить)
    DATAMATRIX = "datamatrix"   # Мелкий Datamatrix для сканера
    RFID = "rfid"               # RFID-метка (дальность больше)
```

**Магнитный код** (супер-просто!):
```
Код = позиция магнитов:

  ┌───────────────┐
  │ [●][ ][●][ ]  │  ← 4 позиции = 16 комбинаций
  │  1  2  3  4   │    Магнит 6×3 мм
  └───────────────┘
  
  Пример: ●○●○ = код "5" = "Электроника"
```

- Hall-датчики в раме стойки
- При установке ящика — автоопределение номера
- Home Assistant: entity per drawer

**Home Assistant интеграция**:
- Место под ESP32/ESP8266 модуль (отсек 30×25×10 мм)
- Отверстия под питание micro-USB
- Интеграция с датчиками:
  - Геркон (открыт/закрыт)
  - Тензодатчик (вес содержимого)
  - Температура/влажность (для лекарств)

**Автоматизация**:
- Сервопривод для автооткрытия (SG90)
- Соленоидный замок для секретного ящика

### Экологичность

- **Минимум пластика**: сотовое заполнение стенок (экономия 40%)
- **Биоразлагаемый вариант**: оптимизация под печать из PLA Wood
- **Переработка**: маркировка материала на дне
- **Универсальность**: стандартные размеры для замены вставок

### Готовые пресеты

```python
class BoxPreset(Enum):
    # Для прихожей
    ENTRYWAY_KEYS = BoxConfig(150, 120, 50, DesignStyle.NORDIC)      # Ключи, мелочь
    ENTRYWAY_MASKS = BoxConfig(200, 150, 60, DesignStyle.STEALTH)    # Маски, перчатки
    
    # Для рабочего стола
    DESK_STATIONERY = BoxConfig(250, 180, 60, DesignStyle.BAUHAUS)   # Канцелярия
    DESK_TECH = BoxConfig(200, 220, 80, DesignStyle.TECHNO)          # Гаджеты, кабели
    DESK_CARDS = BoxConfig(120, 100, 40, DesignStyle.PARAMETRIC)     # Визитки, карты
    
    # Для мастерской
    WORKSHOP_SCREWS = BoxConfig(150, 200, 50, DesignStyle.NORDIC)    # Метизы
    WORKSHOP_BITS = BoxConfig(180, 120, 40, DesignStyle.TECHNO)      # Биты, свёрла
    WORKSHOP_PARTS = BoxConfig(300, 250, 100, DesignStyle.STEALTH)   # Запчасти
    
    # Для ванной/аптечки
    BATHROOM_MEDS = BoxConfig(180, 150, 70, DesignStyle.ORGANIC)     # Лекарства
    BATHROOM_COSMETIC = BoxConfig(200, 180, 60, DesignStyle.NORDIC)  # Косметика
    
    # Для гардероба
    CLOSET_JEWELRY = BoxConfig(250, 200, 50, DesignStyle.PARAMETRIC) # Украшения
    CLOSET_ACCESSORIES = BoxConfig(300, 220, 80, DesignStyle.ORGANIC) # Аксессуары
```

### Текстуры поверхностей (FDM-оптимизированные)

```python
class SurfaceTexture(Enum):
    SMOOTH = "smooth"           # Гладкая (стандарт)
    MATTE = "matte"             # Микрорельеф 0.1 мм (антиблик)
    GRIP = "grip"               # Рифлёная (нескользящая)
    WOOD_GRAIN = "wood"         # Имитация дерева
    LEATHER = "leather"         # Имитация кожи
    FABRIC = "fabric"           # Имитация ткани (лён)
    CONCRETE = "concrete"       # Бетон (лофт-стиль)
    CARBON = "carbon"           # Карбоновое плетение

class TextureQuality(Enum):
    FDM_STANDARD = "fdm"        # 0.2 мм слой, глубина 0.25-0.4 мм
    FDM_FINE = "fdm_fine"       # 0.12 мм слой, глубина 0.15-0.25 мм  
    SLA = "sla"                 # Высокое качество, глубина 0.05-0.1 мм
```

**FDM-friendly правила**:
- Минимальная глубина рельефа = высота слоя × 1.5
- Для K1C (0.2 мм слой): рельеф 0.3–0.4 мм
- Для тонкого слоя (0.12 мм): рельеф 0.18–0.25 мм
- Текстуры wood/leather/carbon: требуют минимум 0.35 мм глубины на FDM
- Авто-упрощение сложных текстур при грубом слое

## Система разделителей (Dividers)

### Универсальный паз (Rail System)

```
Разрез ящика:

        Боковая стенка         Дно
              │                │
    ┌─────────┴────────┬───────┴───────┐
    │  ═══════════════ │ ═══════════════│  ← Универсальный паз
    │  (боковой паз)   │  (донный паз)  │    ширина 2.4 мм
    └──────────────────┴────────────────┘
```

- Единый стандарт посадки: ширина 2.4 мм, глубина 3 мм
- Подходит для:
  - Разделителей (dividers)
  - Вкладышей-дна (inserts)
  - Держателей (holders)
  - Карманов (pockets)
- Как IKEA рейки — бесконечная кастомизация

### Два режима: Snap и Lock

**SNAP (быстросъёмные)**:
```
Разрез паза:

  Стенка ящика     Разделитель
       │              │
       │    ╔═════════╧═════════╗
       │    ║                   ║
       └────╨───────────────────╨────
            ↑                   ↑
       Скруглённые края (R=1 мм)
       для лёгкого входа/выхода
```
- Вставляются/вынимаются пальцами
- Зазор: `tolerance["loose"]` (0.4 мм)
- Скруглённые края пазов
- Для частой перенастройки

**LOCK (с замком)**:
```
Разрез паза:

  Стенка ящика     Разделитель
       │              │
       │    ╔═══════╤═╧═╤═══════╗
       │    ║       │ ▼ │       ║  ← Защёлка
       └────╨───────┴───┴───────╨────
```
- Защёлка фиксирует разделитель
- Зазор: `tolerance["snap"]` (0.21 мм)
- Для мастерской (не гуляют)
- Снимаются с усилием или инструментом

### Сетка с ключевыми точками

```
Вид сверху (дно ящика):

    A     B     C     D
  ┌───┬───┬───┬───┬───┐
1 │   │   │   │   │   │
  ├───┼───┼───┼───┼───┤
2 │   │ ★ │   │   │   │  ← ★ = ключевой паз (глубже)
  ├───┼───┼───┼───┼───┤
3 │   │   │   │ ★ │   │
  └───┴───┴───┴───┴───┘
    
  Маркировка на разделителях: A1, B2, C3...
```
- 1-2 ключевых паза (глубже на 1 мм)
- Рельефная маркировка на кромке разделителя
- Однозначная сборка без путаницы

### Модульные вкладыши-дно (первоклассный продукт!)

```python
class InsertType(Enum):
    FLAT = "flat"               # Плоское дно (стандарт)
    HONEYCOMB = "honeycomb"     # Соты для круглых предметов
    CABLE_WAVES = "cable"       # Волны для кабелей
    BIT_HOLDER = "bits"         # Держатель бит/свёрел
    COIN_TRAY = "coins"         # Лоток для монет
    FOAM_GRID = "foam"          # Сетка под поролон/пену
    PENCIL_GROOVES = "pencils"  # Желобки для ручек
    WATCH_CUSHION = "watch"     # Подушечки для часов
```

```
Вкладыш "CABLE_WAVES":

  ╭───╮ ╭───╮ ╭───╮ ╭───╮
  │   │ │   │ │   │ │   │  ← Волнистые желобки
  ╰───╯ ╰───╯ ╰───╯ ╰───╯    под кабели разного Ø
```

- Толщина вкладыша: 1.2–1.6 мм (печатается быстро)
- Вставляется "плоско" в донные пазы
- **Фишка**: корпус/ящик один — меняешь только вкладыши!

## Геометрические вариации

### Формы корпуса

```python
class ShellGeometry(Enum):
    RECTANGULAR = "rectangular"     # Стандартный параллелепипед
    SLOPED_TOP = "sloped_top"       # Скошенная крышка (трапеция, перед ниже)
    SLOPED_BACK = "sloped_back"     # Скошенная спинка (для настольного)
    WEDGE = "wedge"                 # Клин (обе стороны скошены)
    CURVED_TOP = "curved_top"       # Выпуклая крышка (дуга)
    STEPPED = "stepped"             # Ступенчатый (2-3 уровня)
    ASYMMETRIC = "asymmetric"       # Асимметричный (одна сторона выше)
```

**SLOPED_TOP — Скошенная крышка (трапеция)**:
```
Вид сбоку:
___________
|           \      ← Передняя грань скошена (угол 15°)
|            \     ← Задняя стенка вертикальная (прямая)
|             \
|______________\
      Дно         Перед
```
- Угол наклона: 10-20° (настраиваемый)
- Задняя грань — всегда вертикальная (для стыковки к стене/друг к другу)
- Передняя грань скошена — формирует единый скос при стыковке
- При вертикальной стыковке: ящики образуют лестницу/каскад

```
Вид сбоку (стопка из 3 ящиков):

    ___\
   |____\
   ___\  |
  |____\ |
  ___\  ||
 |____\ ||
        Единый скос →
```

**SLOPED_BACK — Скошенная спинка**:
- Задняя стенка под углом 20°
- Передняя панель шире задней
- Визуально «летящая» форма
- Хорошо для настенного монтажа

**ASYMMETRIC — Асимметричный**:
- Левая сторона выше правой (или наоборот)
- Создаёт динамичную композицию при стыковке
- Угол 5-10°

```python
@dataclass
class GeometryConfig:
    shape: ShellGeometry = ShellGeometry.RECTANGULAR
    slope_angle: float = 15.0           # Угол наклона в градусах
    slope_direction: str = "front"      # front, left, right
    maintain_back_vertical: bool = True  # Задняя грань всегда вертикальна (для стыковки)
```

## Система цветных вставок (для одноцветного принтера)

### Концепция

Передняя панель ящика разделена на **базу** и **сменные декоративные вставки** на защёлках. Печатаете базу одним цветом, вставки — другими.

### Типы вставок

```python
class ColorInsert(Enum):
    # Функциональные
    LABEL_FRAME = "label_frame"       # Рамка вокруг этикетки
    HANDLE_ACCENT = "handle_accent"   # Акцентная полоса на ручке
    EDGE_TRIM = "edge_trim"           # Окантовка по периметру
    
    # Декоративные
    STRIPE_HORIZONTAL = "stripe_h"    # Горизонтальная полоса
    STRIPE_VERTICAL = "stripe_v"      # Вертикальная полоса  
    CORNER_CAPS = "corner_caps"       # Угловые накладки (4 шт)
    CENTER_BADGE = "badge"            # Центральный значок/логотип
    WAVE_PATTERN = "wave"             # Волнистая накладка
    
    # Информационные
    NUMBER_PLATE = "number"           # Номер ящика (1, 2, 3...)
    ICON_SYMBOL = "icon"              # Иконка содержимого
    COLOR_DOT = "dot"                 # Цветная точка-индикатор
```

### Механизм крепления

**Snap-fit защёлки**:
```
Вид сверху (разрез):

База:      [====□====□====]   ← Пазы с поднутрением
Вставка:       ╔═╗    ╔═╗     ← Выступы-защёлки
               ╚═╝    ╚═╝
```
- Защёлки с углом 45° для лёгкой вставки
- Глубина паза: 1.5 мм
- Зазор: 0.2 мм для плотной посадки
- Материал вставок: рекомендуется PETG (гибче)

### Шаблон передней панели

```
┌─────────────────────────────────────┐
│  ┌───┐                       ┌───┐  │  ← CORNER_CAPS
│  └───┘   ┌───────────────┐   └───┘  │
│          │  LABEL_FRAME  │          │
│  ════════│   (этикетка)  │════════  │  ← STRIPE_HORIZONTAL
│          └───────────────┘          │
│                                     │
│  ┌─────────────────────────────┐    │
│  │      HANDLE_ACCENT          │    │  ← На ручке
│  └─────────────────────────────┘    │
│  ┌───┐                       ┌───┐  │
│  └───┘                       └───┘  │  ← CORNER_CAPS
└─────────────────────────────────────┘
```

### Цветовое кодирование

```python
class ColorCode(Enum):
    # По категориям
    ELECTRONICS = "blue"        # Электроника
    TOOLS = "red"               # Инструменты
    OFFICE = "green"            # Канцелярия
    HEALTH = "white"            # Медицина
    HOBBY = "yellow"            # Хобби
    MISC = "gray"               # Разное
    
    # По приоритету
    URGENT = "red"
    NORMAL = "green"  
    ARCHIVE = "gray"
```

## Ещё идеи

### Секретный отсек
- Двойное дно с магнитным замком
- Открывается при нажатии в определённой точке
- Глубина: 15 мм под основным ящиком

### Выдвижной лоток с подсветкой
- Паз под LED-ленту по периметру дна
- Датчик холла — включается при выдвижении
- Питание через контакты в направляющих

### Система каскадного открытия
- Верхний ящик тянет нижний на 30%
- Как ступени — видно содержимое всех ящиков
- Пружинный возврат

### Модульное дно
- Сменные вкладыши с разной геометрией:
  - Соты (для круглых предметов)
  - Желобки (для ручек/карандашей)
  - Волны (для кабелей)
  - Пена-вырезка (под конкретные предметы)

### Магнитные разделители
- Металлические полосы в стенках ящика
- Разделители с магнитами — ставятся в любое место
- Бесконечная кастомизация

### Складная конструкция
- Ящик собирается из плоских частей
- Экономия времени печати (40%)
- Соединение: живые петли или защёлки
- Удобно для транспортировки

### Прозрачная передняя вставка
- Паз под акриловое/PETG стекло
- Видно содержимое без открытия
- Толщина 2 мм, крепление на защёлках

### Индикатор заполненности
- Флажок-указатель сбоку ящика
- 3 позиции: пусто / частично / полно
- Виден в закрытом состоянии

### Система «антипыль»
- Резиновый уплотнитель по периметру (паз под О-профиль)
- Лабиринтное соединение панелей
- Для хранения электроники, оптики

## Маленькие "wow"-идеи (почти бесплатные)

### Калибровочный test piece
```
┌────────────────────────┐
│  TEST PIECE v1.0       │
│  ┌──────┐  ┌──────┐    │
│  │RAIL  │  │DRAWER│    │  ← Миниатюрный кусок направляющей + ящика
│  │ ≈≈≈  │  │ ≈≈≈  │    │    для проверки зазоров под конкретный
│  └──────┘  └──────┘    │    принтер/пластик
│  Material: ___         │
│  Printer: K1C          │
└────────────────────────┘
```
- Печатается за 10 минут
- Проверка slide/snap/pressfit tolerance
- Подбор идеальных зазоров до полной печати

### Набор тестовых деталей (Test Kit)

Вместо одной детали — 4 микро-теста (по 5-12 минут каждый):

```python
class TestPiece(Enum):
    RAIL_CLEARANCE = "rail_test"    # 3 уровня зазора: 0.25/0.30/0.35 мм
    SNAP_FIT = "snap_test"          # 3 защёлки разной упругости
    MAGNET_PRESSFIT = "magnet_test" # Отверстия 6.0/6.1/6.2 мм
    TEXTURE_TILE = "texture_test"   # 4 текстуры × 2 глубины
```

```
RAIL_CLEARANCE_TEST:
┌─────────────────────────────────┐
│  0.25mm   │  0.30mm   │  0.35mm │
│  ┌─────┐  │  ┌─────┐  │  ┌─────┐│
│  │~~~~~│  │  │~~~~~│  │  │~~~~~││  ← Какой скользит лучше?
│  └─────┘  │  └─────┘  │  └─────┘│
└─────────────────────────────────┘

Манифест запишет: "Выбран зазор: 0.30 мм"
```

### Сервисные элементы
- **Отверстия снизу**: выдавить застрявший ящик, выдуть пыль
- **Метка версии**: рельеф на дне "PLA v1.3 K1C"
- **QR-код модели**: ссылка на параметры (опционально)

### Скрытые стопки-ножки
```
Вид сбоку (стыковка):

  Верхний ящик
  ┌─────────────────┐
  │     ▼     ▼     │ ← Выступы-ножки 1.5 мм
  └──┬──────────┬───┘
     │          │
  ┌──▼──────────▼───┐ ← Ответные выемки
  │                 │
  └─────────────────┘
  Нижний ящик
```
- Центрирование при установке друг на друга
- Работает даже без dovetail
- Не мешает соединительным элементам

## Режимы печати (Print Mode)

```python
class PrintMode(Enum):
    DRAFT = "draft"       # Быстро, без мелких деталей
    NORMAL = "normal"     # Стандарт
    PREMIUM = "premium"   # Максимум деталей
```

**DRAFT mode** (быстрая печать):
- Без текстур (smooth surface)
- Упрощённые рёбра жёсткости
- Окна в рельсах реже (каждые 50 мм)
- Минимум нависаний
- Толще стенки (для прочности без деталей)

**NORMAL mode** (стандарт):
- Базовые текстуры
- Все функциональные элементы
- Оптимальный баланс

**PREMIUM mode** (выставочное качество):
- Сложные текстуры
- Дополнительные декоративные элементы
- Тонкая проработка деталей

## Правило 45° (Overhang Control)

```
ПЛОХО (>45°):              ХОРОШО (≤45°):
                              
    ┌────────────┐           ┌──╲────────┐
    │            │           │   ╲       │
    │    сопли   │           │    ╲ 45°  │
    └────────────┘           └─────╲─────┘
       нависание              самоподдержка
```

**Автоматические проверки**:
- Пылевая губа: фаска 45° на нижней кромке
- Карманы под магниты: арочный/треугольный потолок
- Защёлки: угол входа ≤45°
- Все горизонтальные нависания → скосы

## Хитрые идеи

### Механический секретный замок

```
Вид сверху (секретный отсек):

┌────────────────────────────────┐
│                                │
│   ┌──────────────────┐         │
│   │  СЕКРЕТНЫЙ ОТСЕК │         │
│   │                  │         │
│   └──────────────────┘         │
│          ↑                     │
│   Магнитный ключ с полярностью │
│   или "нажми 2 точки"          │
└────────────────────────────────┘
```

- Без электроники!
- Открывается ключом-вставкой с магнитами (полярность = код)
- Или: нажать 2 точки одновременно (как скрытый замок)

### Anti-tip для настенного монтажа

```
Вид сбоку (настенный):

    Стена
      │    ╔════╗ ← Верхний зуб-рычаг
      │    ║    ║
      │════╝    ╚════│
      │              │
      │   КОРПУС     │
      │              │
      │    ┌────┐    │
      │    │ЯЩИК│→→→ │ ← Выдвинутый ящик
      └────┴────┴────┘
```

- При выдвижении ящик тянет вниз
- Верхний "зуб" крепления работает как рычаг
- Не даёт корпусу "клюнуть" вперёд

### Визуальный каскад (без механизма)

```
Вид спереди:

  ┌─────────────────┐   ─┐
  │     ЯЩИК 1      │    │ h1
  ├─────────────────┤   ─┼─ Разная высота
  │    ЯЩИК 2       │    │ h2  передних панелей
  ├─────────────────┤   ─┼─
  │   ЯЩИК 3        │    │ h3
  └─────────────────┘   ─┘
  
  + разный "вылет" стопоров
```

- Разная высота передних панелей
- Разные ограничители вылета
- Визуально = "ступени"
- Без сложной тяги ящик-ящик

## Архитектура проекта

```
models/home_item/storage_box/
├── __init__.py
├── config/
│   ├── __init__.py
│   ├── box_config.py           # BoxConfig (входные параметры)
│   ├── derived_config.py       # DerivedConfig (вычисленные)
│   ├── design_tokens.py        # DesignTokens (стили)
│   ├── tolerances.py           # Tolerance profiles по материалам
│   ├── presets.py              # BoxPreset (готовые конфигурации)
│   └── rules.py                # Rules engine
├── components/
│   ├── __init__.py
│   ├── shell.py                # Корпус
│   ├── drawer.py               # Ящик
│   ├── dividers.py             # Разделители
│   ├── rails.py                # Направляющие (V-profile, dust lip)
│   ├── stops.py                # Стопоры (двухступенчатые)
│   ├── connections.py          # Соединения (dovetail, magnet, clip)
│   ├── front_panel.py          # Передняя панель + ручка + этикетка
│   ├── color_inserts.py        # Цветные вставки
│   ├── inserts.py              # Модульные вкладыши-дно
│   └── smart_cartridge.py      # Smart-модули
├── geometry/
│   ├── __init__.py
│   ├── primitives.py           # Базовые формы
│   ├── boolean_ops.py          # Булевы операции
│   ├── fillets.py              # Скругления/фаски
│   ├── textures.py             # Генерация текстур
│   └── overhang_check.py       # Проверка правила 45°
├── export/
│   ├── __init__.py
│   ├── stl_exporter.py         # Экспорт STL
│   └── print_manifest.py       # Манифест печати
├── tests/
│   ├── __init__.py
│   ├── rail_clearance_test.py  # Тест зазоров направляющих
│   ├── snap_fit_test.py        # Тест защёлок
│   ├── magnet_pressfit_test.py # Тест посадки магнитов
│   └── texture_test.py         # Тест текстур
├── storage_box.py              # Главный скрипт
└── test_piece.py               # Калибровочная деталь
```

### Rules Engine (вместо условий)

```python
from abc import ABC, abstractmethod

class Rule(ABC):
    """Базовый класс правила"""
    @abstractmethod
    def evaluate(self, config: BoxConfig) -> Any:
        pass
    
    @abstractmethod
    def validate(self, config: BoxConfig) -> list[str]:
        """Возвращает список предупреждений"""
        pass

class RuleWallThickness(Rule):
    """Правило выбора толщины стенки"""
    def evaluate(self, config: BoxConfig) -> float:
        area = config.width * config.height / 1000
        base = 2.0 if area < 100 else 2.4 if area < 160 else 3.2
        if config.stack_levels > 2:
            base += 0.4
        return round(base / 0.4) * 0.4

class RuleEnableLabel(Rule):
    """Правило включения этикетки"""
    def evaluate(self, config: BoxConfig) -> bool:
        return config.width >= 80  # Минимум для этикетки

class RuleChooseConnection(Rule):
    """Правило выбора соединения"""
    def evaluate(self, config: BoxConfig) -> ConnectionType:
        if config.mount == "wall":
            return ConnectionType.MAGNET
        if config.expected_weight > 1000:
            return ConnectionType.DOVETAIL
        return config.connection

# Регистрация правил
RULES = [
    RuleWallThickness(),
    RuleEnableLabel(),
    RuleChooseConnection(),
    # Легко добавлять новые правила для новых принтеров/материалов
]
```

### Версионирование модели

```python
@dataclass
class ModelVersion:
    """Версионирование для совместимости"""
    
    model_version: str = "1.0.0"      # Версия геометрии модели
    compat_version: str = "1.0"       # Версия совместимости вставок
    
    # Что входит в compat_version:
    # - Размеры универсального паза (2.4×3 мм)
    # - Размеры smart cartridge ниши (30×25×12 мм)
    # - Размеры магнитных карманов (6.1 мм)
    
    # Можно менять:
    # - Геометрию рельс (model_version)
    # - Декор и текстуры (model_version)
    # - Рёбра жёсткости (model_version)
    
    # Нельзя менять без compat_version bump:
    # - Ширину пазов под вставки
    # - Размеры картриджей
    
    def is_compatible(self, other: "ModelVersion") -> bool:
        return self.compat_version == other.compat_version
```

**Пример**:
- `v1.0.0` — первый релиз
- `v1.1.0` — новые текстуры (совместим с 1.0 вставками)
- `v2.0.0` — изменён размер паза (НЕ совместим!)

### Слои архитектуры

```
┌─────────────────────────────────────────────┐
│              storage_box.py                 │  ← Entry point
├─────────────────────────────────────────────┤
│                 config/                     │  ← Конфигурация
│   BoxConfig → DerivedConfig → DesignTokens  │
├─────────────────────────────────────────────┤
│               components/                   │  ← Компоненты
│   build_shell() build_drawer() build_*()   │
├─────────────────────────────────────────────┤
│                geometry/                    │  ← Геометрия (bpy)
│   create_mesh() boolean() fillet()          │
├─────────────────────────────────────────────┤
│                 export/                     │  ← Вывод
│   to_stl() generate_manifest()              │
└─────────────────────────────────────────────┘
```

### Print Manifest (пакет печати)

```python
@dataclass
class PrintManifest:
    """Генерируется вместе с STL файлами"""
    
    files: list[PrintFile]
    total_print_time: str
    total_filament: float  # граммы
    
@dataclass
class PrintFile:
    filename: str           # "shell_200x220x80.stl"
    component: str          # "shell"
    material: str           # "Hyper PLA"
    color: str              # "RAL 7035"
    quantity: int           # 1
    orientation: str        # "bottom down"
    supports: bool          # False
    infill: int             # 15
    walls: int              # 3
    estimated_time: str     # "2h 15m"
    estimated_weight: float # 45.2g
    notes: str              # "Print with brim for adhesion"
```

**Пример манифеста**:
```yaml
# print_manifest.yaml
model: Storage Box 200x220x80 NORDIC
version: 1.3
printer: Creality K1C
material: Hyper PLA

files:
  - name: shell.stl
    quantity: 1
    orientation: bottom_down
    supports: false
    infill: 15%
    walls: 3
    time: 2h 15m
    weight: 45g
    
  - name: drawer.stl
    quantity: 1
    orientation: front_down
    supports: false
    infill: 15%
    walls: 3
    time: 1h 40m
    weight: 32g
    
  - name: divider_cross.stl
    quantity: 4
    orientation: flat
    supports: false
    infill: 20%
    walls: 2
    time: 8m each
    weight: 3g each
    
  - name: test_piece.stl
    quantity: 1
    note: "Print first to verify tolerances"
    time: 10m
    weight: 2g

total_time: ~4h 30m
total_weight: ~125g

assembly_notes:
  - Insert drawer into shell
  - Snap in dividers (see grid layout)
  - Optional: glue magnets into pockets
```

## План реализации

### Фаза 1: Базовая инфраструктура
1. Создать структуру проекта
2. Реализовать `BoxConfig` и `DerivedConfig` с валидацией
3. Реализовать `DesignTokens` для всех стилей
4. Базовые геометрические примитивы

### Фаза 2: Корпус (Shell)
1. Внешние стенки с геометрическими вариациями (sloped_top)
2. V-профиль направляющих с пылевым лабиринтом
3. Окна в рельсах каждые 35 мм
4. Микро-ножки / анти elephant foot
5. Соединительные элементы (dovetail, magnet pockets, clips)
6. Smart Cartridge ниша

### Фаза 3: Ящик (Drawer)
1. Лоток с V-пазами под направляющие
2. Пылевые полки
3. Двухступенчатые стопоры + release slot
4. Передняя панель с рёбрами жёсткости
5. Ручка по стилю (с внутренними радиусами!)
6. Система этикеток
7. Слоты под цветные вставки

### Фаза 4: Разделители и аксессуары
1. Snap и Lock режимы разделителей
2. Ключевые точки и маркировка
3. Цветные вставки (защёлки)
4. Заглушки для магнитов

### Фаза 5: Экспорт и тестирование
1. STL экспорт по компонентам
2. Print Manifest генератор
3. Test piece для калибровки
4. Валидация на разных размерах

## Параметры печати (Creality K1C)

| Компонент | Материал | Заполнение | Стенки | Слой | Поддержки |
|-----------|----------|------------|--------|------|-----------|
| Shell | Hyper PLA | 15% | 3 | 0.2 | Нет |
| Drawer | Hyper PLA | 15% | 3 | 0.2 | Нет |
| Dividers | Hyper PLA | 20% | 2 | 0.2 | Нет |
| Color inserts | PETG | 100% | 2 | 0.16 | Нет |
| Snap parts | PETG | 100% | 3 | 0.16 | Нет |
| Test piece | Any | 20% | 2 | 0.2 | Нет |

**K1C специфичные настройки**:
- Скорость: 300 мм/с (стандарт K1C)
- Температура: 220°C Hyper PLA / 240°C PETG
- Стол: 55°C PLA / 70°C PETG
- Обдув: 100% после 2-го слоя
- Brim: рекомендуется для shell (большая площадь)

## YAML конфигурация (сохранение/загрузка)

### Формат файла `box_config.yaml`

```yaml
# Storage Box Configuration
# Version: 1.0

meta:
  model_version: "1.2.0"
  compat_version: "1.0"
  created: "2026-01-28T12:00:00"
  author: "user"
  description: "Workshop storage for small electronics"

# === Основные размеры ===
dimensions:
  width: 200.0
  depth: 220.0
  height: 80.0

# === Дизайн и стиль ===
design:
  style: "belovodie"           # nordic, techno, bauhaus, organic, parametric, stealth, belovodie
  belovodie_preset: "workshop" # desk, workshop, med, sacred (только для belovodie)
  
  colors:
    body: "obsidian"           # Основной цвет корпуса
    accent: "bronze_warm"      # Цвет акцентов
    label_frame: "ash_grey"    # Цвет рамки этикетки

# === Материал и принтер ===
material:
  type: "hyper_pla"            # hyper_pla, petg, abs
  printer: "k1c"               # k1c, fdm, hd
  print_mode: "normal"         # draft, normal, premium

# === Механика ===
mechanics:
  rail_profile: "v_profile"    # rectangular, v_profile, dovetail, t_slot
  connection: "dovetail"       # dovetail, magnet, clip, none
  
  anti_wobble:
    type: "spring_whisker"     # wedge, spring_whisker, none
    
  stops:
    type: "two_stage"          # simple, two_stage
    sound_profile: "soft_click" # silent, soft_click, mech_click

# === Разделители ===
dividers:
  layout: "auto"               # auto, grid_2x2, grid_2x3, grid_3x3, none
  target_cell_size: [50, 50]   # Целевой размер ячейки
  mode: "snap"                 # snap, lock
  
  # Модульные вставки
  inserts:
    - type: "foam"
      cells: [[0,0], [0,1]]
    - type: "velour"
      cells: [[1,1]]

# === Контекст использования ===
context:
  mount: "table"               # table, wall
  stack_levels: 2
  expected_weight: 800.0       # грамм

# === Ручка ===
handle:
  profile: "hidden_hook_rune"  # pinch, hook, glove, hidden_hook_rune, rune_slot
  tactile_zone: true
  
# === Этикетка ===
label:
  frame_style: "recessed_portal"  # flush, raised, recessed, recessed_portal
  version_mark: true              # Метка версии BV-x.x
  
# === Smart-функции ===
smart:
  cartridge: "plain"           # plain, nfc, hall, esp, cable, dht
  hub_connector: false         # Разъём для Hub-модуля
  
# === Специальные версии ===
special:
  sealed: false                # Герметичная версия (O-profile паз)
  service_channel: true        # Канал продувки
  
# === Паттерны (для belovodie) ===
patterns:
  type: "chevron_rune"         # chevron_rune, knot_line, wave_rune, grid_rune, none
  position: "back_edge"        # back_edge, front_band, sides
  spacing: 8.0
  band_height: 14.0

# === Микро-детали ===
details:
  shadow_gap: 0.4
  guide_cones: true            # Направляющие-маяки
  rune_key: true               # Ключ стыковки в форме руны
  rivet_dots: true             # Имитация заклёпок
```

### Python модуль `config_manager.py`

```python
"""
YAML конфигурация ящиков для хранения
Сохранение/загрузка параметров
"""
import yaml
from pathlib import Path
from dataclasses import dataclass, field, asdict
from datetime import datetime
from typing import Optional
from enum import Enum

# Версия формата конфига
CONFIG_FORMAT_VERSION = "1.0"

@dataclass
class YAMLConfig:
    """Полная конфигурация из YAML"""
    
    # Meta
    model_version: str = "1.0.0"
    description: str = ""
    
    # Dimensions
    width: float = 200.0
    depth: float = 220.0
    height: float = 80.0
    
    # Design
    style: str = "nordic"
    belovodie_preset: str = "desk"
    color_body: str = "mist_white"
    color_accent: str = "emerald_deep"
    
    # Material
    material: str = "hyper_pla"
    printer: str = "k1c"
    print_mode: str = "normal"
    
    # Mechanics
    rail_profile: str = "v_profile"
    connection: str = "dovetail"
    anti_wobble: str = "spring_whisker"
    sound_profile: str = "soft_click"
    
    # Dividers
    divider_layout: str = "auto"
    target_cell_size: tuple = (50, 50)
    divider_mode: str = "snap"
    
    # Context
    mount: str = "table"
    stack_levels: int = 1
    expected_weight: float = 500.0
    
    # Handle & Label
    handle_profile: str = "hidden_hook_rune"
    label_style: str = "recessed_portal"
    
    # Smart
    smart_cartridge: str = "plain"
    
    # Special
    sealed: bool = False
    service_channel: bool = False
    
    # Patterns
    pattern_type: str = "none"
    pattern_position: str = "back_edge"
    
    # Details
    shadow_gap: float = 0.4
    guide_cones: bool = True


class ConfigManager:
    """Менеджер конфигураций"""
    
    DEFAULT_PATH = Path("configs")
    
    def __init__(self, config_dir: Optional[Path] = None):
        self.config_dir = config_dir or self.DEFAULT_PATH
        self.config_dir.mkdir(parents=True, exist_ok=True)
    
    def save(self, config: YAMLConfig, filename: str) -> Path:
        """Сохранить конфигурацию в YAML"""
        filepath = self.config_dir / f"{filename}.yaml"
        
        data = {
            "meta": {
                "model_version": config.model_version,
                "compat_version": CONFIG_FORMAT_VERSION,
                "created": datetime.now().isoformat(),
                "description": config.description
            },
            "dimensions": {
                "width": config.width,
                "depth": config.depth,
                "height": config.height
            },
            "design": {
                "style": config.style,
                "belovodie_preset": config.belovodie_preset,
                "colors": {
                    "body": config.color_body,
                    "accent": config.color_accent
                }
            },
            "material": {
                "type": config.material,
                "printer": config.printer,
                "print_mode": config.print_mode
            },
            "mechanics": {
                "rail_profile": config.rail_profile,
                "connection": config.connection,
                "anti_wobble": {"type": config.anti_wobble},
                "stops": {"sound_profile": config.sound_profile}
            },
            "dividers": {
                "layout": config.divider_layout,
                "target_cell_size": list(config.target_cell_size),
                "mode": config.divider_mode
            },
            "context": {
                "mount": config.mount,
                "stack_levels": config.stack_levels,
                "expected_weight": config.expected_weight
            },
            "handle": {"profile": config.handle_profile},
            "label": {"frame_style": config.label_style},
            "smart": {"cartridge": config.smart_cartridge},
            "special": {
                "sealed": config.sealed,
                "service_channel": config.service_channel
            },
            "patterns": {
                "type": config.pattern_type,
                "position": config.pattern_position
            },
            "details": {
                "shadow_gap": config.shadow_gap,
                "guide_cones": config.guide_cones
            }
        }
        
        with open(filepath, 'w', encoding='utf-8') as f:
            yaml.dump(data, f, default_flow_style=False, 
                     allow_unicode=True, sort_keys=False)
        
        return filepath
    
    def load(self, filename: str) -> YAMLConfig:
        """Загрузить конфигурацию из YAML"""
        filepath = self.config_dir / f"{filename}.yaml"
        
        if not filepath.exists():
            raise FileNotFoundError(f"Config not found: {filepath}")
        
        with open(filepath, 'r', encoding='utf-8') as f:
            data = yaml.safe_load(f)
        
        # Проверка совместимости
        compat = data.get("meta", {}).get("compat_version", "1.0")
        if compat != CONFIG_FORMAT_VERSION:
            print(f"Warning: Config version {compat} != {CONFIG_FORMAT_VERSION}")
        
        return YAMLConfig(
            model_version=data.get("meta", {}).get("model_version", "1.0.0"),
            description=data.get("meta", {}).get("description", ""),
            
            width=data.get("dimensions", {}).get("width", 200.0),
            depth=data.get("dimensions", {}).get("depth", 220.0),
            height=data.get("dimensions", {}).get("height", 80.0),
            
            style=data.get("design", {}).get("style", "nordic"),
            belovodie_preset=data.get("design", {}).get("belovodie_preset", "desk"),
            color_body=data.get("design", {}).get("colors", {}).get("body", "mist_white"),
            color_accent=data.get("design", {}).get("colors", {}).get("accent", "emerald_deep"),
            
            material=data.get("material", {}).get("type", "hyper_pla"),
            printer=data.get("material", {}).get("printer", "k1c"),
            print_mode=data.get("material", {}).get("print_mode", "normal"),
            
            rail_profile=data.get("mechanics", {}).get("rail_profile", "v_profile"),
            connection=data.get("mechanics", {}).get("connection", "dovetail"),
            anti_wobble=data.get("mechanics", {}).get("anti_wobble", {}).get("type", "none"),
            sound_profile=data.get("mechanics", {}).get("stops", {}).get("sound_profile", "soft_click"),
            
            divider_layout=data.get("dividers", {}).get("layout", "auto"),
            target_cell_size=tuple(data.get("dividers", {}).get("target_cell_size", [50, 50])),
            divider_mode=data.get("dividers", {}).get("mode", "snap"),
            
            mount=data.get("context", {}).get("mount", "table"),
            stack_levels=data.get("context", {}).get("stack_levels", 1),
            expected_weight=data.get("context", {}).get("expected_weight", 500.0),
            
            handle_profile=data.get("handle", {}).get("profile", "hidden_hook_rune"),
            label_style=data.get("label", {}).get("frame_style", "recessed_portal"),
            
            smart_cartridge=data.get("smart", {}).get("cartridge", "plain"),
            
            sealed=data.get("special", {}).get("sealed", False),
            service_channel=data.get("special", {}).get("service_channel", False),
            
            pattern_type=data.get("patterns", {}).get("type", "none"),
            pattern_position=data.get("patterns", {}).get("position", "back_edge"),
            
            shadow_gap=data.get("details", {}).get("shadow_gap", 0.4),
            guide_cones=data.get("details", {}).get("guide_cones", True)
        )
    
    def list_configs(self) -> list[str]:
        """Список всех сохранённых конфигураций"""
        return [f.stem for f in self.config_dir.glob("*.yaml")]
    
    def to_box_config(self, yaml_config: YAMLConfig) -> "BoxConfig":
        """Конвертация YAMLConfig → BoxConfig для генерации"""
        return BoxConfig(
            width=yaml_config.width,
            depth=yaml_config.depth,
            height=yaml_config.height,
            design=DesignStyle(yaml_config.style),
            material=MaterialType(yaml_config.material),
            dividers=DividerLayout(yaml_config.divider_layout),
            connection=ConnectionType(yaml_config.connection),
            rail_profile=RailProfile(yaml_config.rail_profile),
            printer=PrinterProfile(yaml_config.printer),
            mount=yaml_config.mount,
            stack_levels=yaml_config.stack_levels,
            expected_weight=yaml_config.expected_weight,
            target_cell_size=yaml_config.target_cell_size
        )


# === Готовые пресеты ===

PRESETS = {
    "mvp": YAMLConfig(
        description="Минимальная версия для быстрого старта",
        style="nordic",
        material="hyper_pla",
        print_mode="draft",
        connection="clip",
        divider_layout="none",
        pattern_type="none"
    ),
    
    "workshop": YAMLConfig(
        description="Мастерская: инструменты и электроника",
        style="belovodie",
        belovodie_preset="workshop",
        color_body="obsidian",
        color_accent="bronze_warm",
        material="petg",
        print_mode="normal",
        connection="dovetail",
        sound_profile="mech_click",
        service_channel=True,
        pattern_type="chevron_rune"
    ),
    
    "smarthome": YAMLConfig(
        description="Умный дом: сенсоры и интеграция",
        style="belovodie",
        belovodie_preset="desk",
        color_body="mist_white",
        color_accent="emerald_deep",
        material="hyper_pla",
        print_mode="premium",
        connection="magnet",
        smart_cartridge="nfc",
        sound_profile="silent",
        pattern_type="knot_line"
    ),
    
    "medical": YAMLConfig(
        description="Аптечка: герметичность и маркировка",
        style="belovodie",
        belovodie_preset="med",
        color_body="stone_sand",
        material="petg",
        sealed=True,
        label_style="recessed_portal",
        pattern_type="none"
    )
}


# === CLI использование ===

if __name__ == "__main__":
    import argparse
    
    parser = argparse.ArgumentParser(description="Storage Box Config Manager")
    parser.add_argument("action", choices=["save", "load", "list", "preset"])
    parser.add_argument("--name", help="Config filename")
    parser.add_argument("--preset", help="Preset name (mvp, workshop, smarthome, medical)")
    
    args = parser.parse_args()
    
    manager = ConfigManager()
    
    if args.action == "list":
        configs = manager.list_configs()
        print("Available configs:", configs)
    
    elif args.action == "preset" and args.preset:
        if args.preset in PRESETS:
            config = PRESETS[args.preset]
            path = manager.save(config, args.name or args.preset)
            print(f"Saved preset '{args.preset}' to {path}")
        else:
            print(f"Unknown preset. Available: {list(PRESETS.keys())}")
    
    elif args.action == "load" and args.name:
        config = manager.load(args.name)
        print(f"Loaded: {config}")
```

### Использование

```bash
# Сохранить пресет
python config_manager.py preset --preset workshop --name my_workshop

# Список конфигов
python config_manager.py list

# Загрузить конфиг
python config_manager.py load --name my_workshop
```

### В коде Blender:

```python
from config_manager import ConfigManager, PRESETS

# Загрузить конфиг
manager = ConfigManager(Path("~/.storage_box/configs").expanduser())
config = manager.load("my_workshop")

# Или использовать пресет
config = PRESETS["smarthome"]

# Конвертировать в BoxConfig для генерации
box_config = manager.to_box_config(config)
derived = DerivedConfig(box_config)

# Генерировать модель
generate_shell(derived)
generate_drawer(derived)
```
